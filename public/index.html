<!DOCTYPE html>
<html lang="mn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Тамхины Түгээлт</title>
  <style>
    /* --- Your Existing CSS Remains Unchanged --- */
    /* Only relevant parts shown here for brevity */
    .brand-card.selected {
      border-color: #0e62ff;
      background-color: #f0f6ff;
    }

    .print-only {
      display: none;
    }

    @media print {
      body * {
        visibility: hidden;
      }
      .print-only, .print-only * {
        visibility: visible;
      }
      .print-only {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        padding: 20px;
      }
    }
  </style>
</head>
<body>

  <div class="distribution-tracker">
    <h2>Бренд сонгох:</h2>
    <div class="brand-grid" id="brandGrid"></div>

    <form id="shipmentForm">
      <input type="text" id="driver" name="driver" placeholder="Жолоочийн нэр" required />
      <input type="text" id="shop" name="shop" placeholder="Дэлгүүрийн нэр" required />
      <select id="packType" name="packType" required>
        <option value="">Сав баглаа боодол</option>
      </select>
      <input type="number" id="quantity" name="quantity" placeholder="Тоо ширхэг" min="1" required />
      <input type="number" id="pricePerPack" name="pricePerPack" placeholder="Сав тутам үнэ ($)" min="0" step="0.01" required />
      <input type="text" id="totalPrice" placeholder="Нийт үнэ" readonly />
      <button type="submit">Түгээмэл бүртгэх ба хэвлэх</button>
    </form>

    <div class="shipment-history">
      <h3>Түгээлтийн түүх</h3>
      <table class="shipment-table">
        <thead>
          <tr>
            <th>Огноо</th>
            <th>Жолооч</th>
            <th>Дэлгүүр</th>
            <th>Бренд</th>
            <th>Сав баглаа</th>
            <th>Тоо</th>
            <th>Үнэ</th>
            <th>Нийт</th>
          </tr>
        </thead>
        <tbody id="shipmentHistory"></tbody>
      </table>
    </div>
  </div>

  <!-- Print section -->
  <div class="print-only" id="printSection">
    <h2>Түгээлтийн баримт</h2>
    <p><strong>Огноо:</strong> <span id="printDate"></span></p>
    <table class="print-shipment-table">
      <tr><th>Жолооч</th><td id="printDriver"></td></tr>
      <tr><th>Дэлгүүр</th><td id="printShop"></td></tr>
      <tr><th>Бренд</th><td id="printBrand"></td></tr>
      <tr><th>Сав баглаа</th><td id="printPackType"></td></tr>
      <tr><th>Тоо ширхэг</th><td id="printQuantity"></td></tr>
      <tr><th>Үнэ</th><td id="printPricePerPack"></td></tr>
      <tr><th>Нийт</th><td id="printTotalPrice"></td></tr>
    </table>
    <p>Гарын үсэг: _________________________</p>
    <p>Огноо: <span id="printSignatureDate"></span></p>
  </div>

  <script>
    const brands = [
      {
        name: "Marlboro",
        image: "https://cdn.prod.website-files.com/663ae41a035a5092ac55e30d/663ae41a035a5092ac55e31f_marlboro.png",
        pricePerPack: 10,
        packTypes: ["Box", "Pack"]
      },
      {
        name: "Winston",
        image: "https://cdn.prod.website-files.com/663ae41a035a5092ac55e30d/663ae41a035a5092ac55e320_winston.png",
        pricePerPack: 9.5,
        packTypes: ["Box", "Pack"]
      },
      {
        name: "L&M",
        image: "https://cdn.prod.website-files.com/663ae41a035a5092ac55e30d/663ae41a035a5092ac55e321_lm.png",
        pricePerPack: 8.75,
        packTypes: ["Box", "Pack"]
      },
      {
        name: "Parliament",
        image: "https://cdn.prod.website-files.com/663ae41a035a5092ac55e30d/663ae41a035a5092ac55e322_parliament.png",
        pricePerPack: 11.25,
        packTypes: ["Box", "Pack"]
      }
    ];

    document.addEventListener("DOMContentLoaded", () => {
      const brandGrid = document.getElementById("brandGrid");

      brands.forEach((brand) => {
        const brandCard = document.createElement("div");
        brandCard.className = "brand-card";
        brandCard.innerHTML = `
          <img src="${brand.image}" alt="${brand.name}" class="brand-image">
          <div>${brand.name}</div>
        `;
        brandCard.addEventListener("click", (event) => selectBrand(event, brand));
        brandGrid.appendChild(brandCard);
      });

      document.getElementById("quantity").addEventListener("input", calculateTotal);
      document.getElementById("pricePerPack").addEventListener("input", calculateTotal);
      document.getElementById("shipmentForm").addEventListener("submit", handleSubmit);
      loadShipmentHistory();
    });

    function selectBrand(event, brand) {
      document.querySelectorAll(".brand-card").forEach((card) => {
        card.classList.remove("selected");
      });
      event.currentTarget.classList.add("selected");

      const packTypeSelect = document.getElementById("packType");
      packTypeSelect.innerHTML = '<option value="">Сав баглаа боодол</option>';
      brand.packTypes.forEach((type) => {
        const option = document.createElement("option");
        option.value = type;
        option.textContent = type;
        packTypeSelect.appendChild(option);
      });

      document.getElementById("pricePerPack").value = brand.pricePerPack;
      calculateTotal();
    }

    function calculateTotal() {
      const quantity = parseFloat(document.getElementById("quantity").value) || 0;
      const price = parseFloat(document.getElementById("pricePerPack").value) || 0;
      document.getElementById("totalPrice").value = (quantity * price).toFixed(2);
    }

    function handleSubmit(e) {
      e.preventDefault();

      const driver = document.getElementById("driver").value;
      const shop = document.getElementById("shop").value;
      const packType = document.getElementById("packType").value;
      const quantity = document.getElementById("quantity").value;
      const pricePerPack = document.getElementById("pricePerPack").value;
      const totalPrice = document.getElementById("totalPrice").value;

      const selectedBrandCard = document.querySelector(".brand-card.selected");
      if (!selectedBrandCard) {
        alert("Бренд сонгоно уу!");
        return;
      }
      const brandName = selectedBrandCard.textContent.trim();

      const shipment = {
        date: new Date().toLocaleString(),
        driver,
        shop,
        brand: brandName,
        packType,
        quantity,
        pricePerPack,
        totalPrice
      };

      saveShipment(shipment);
      addToHistoryTable(shipment);
      preparePrint(shipment);
      window.print();

      document.getElementById("shipmentForm").reset();
      document.getElementById("totalPrice").value = "";
      document.querySelectorAll(".brand-card").forEach((card) => card.classList.remove("selected"));
      document.getElementById("packType").innerHTML = '<option value="">Сав баглаа боодол</option>';
    }

    function saveShipment(shipment) {
      let shipments = JSON.parse(localStorage.getItem("shipments")) || [];
      shipments.push(shipment);
      localStorage.setItem("shipments", JSON.stringify(shipments));
    }

    function loadShipmentHistory() {
      const shipments = JSON.parse(localStorage.getItem("shipments")) || [];
      shipments.forEach(addToHistoryTable);
    }

    function addToHistoryTable(shipment) {
      const tbody = document.getElementById("shipmentHistory");
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${shipment.date}</td>
        <td>${shipment.driver}</td>
        <td>${shipment.shop}</td>
        <td>${shipment.brand}</td>
        <td>${shipment.packType}</td>
        <td>${shipment.quantity}</td>
        <td>$${parseFloat(shipment.pricePerPack).toFixed(2)}</td>
        <td>$${parseFloat(shipment.totalPrice).toFixed(2)}</td>
      `;
      tbody.prepend(tr);
    }

    function preparePrint(shipment) {
      document.getElementById("printDate").textContent = shipment.date;
      document.getElementById("printDriver").textContent = shipment.driver;
      document.getElementById("printShop").textContent = shipment.shop;
      document.getElementById("printBrand").textContent = shipment.brand;
      document.getElementById("printPackType").textContent = shipment.packType;
      document.getElementById("printQuantity").textContent = shipment.quantity;
      document.getElementById("printPricePerPack").textContent = `$${parseFloat(shipment.pricePerPack).toFixed(2)}`;
      document.getElementById("printTotalPrice").textContent = `$${parseFloat(shipment.totalPrice).toFixed(2)}`;
      const now = new Date();
      document.getElementById("printSignatureDate").textContent = `${now.getDate()}/${now.getMonth() + 1}/${now.getFullYear()}`;
    }
  </script>
</body>
</html>
